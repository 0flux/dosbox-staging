# 0.81.0-RC1 release notes

**Release date:** 2023-12-22

!!! warning "Release candidate notes"

    You are reading the release notes of the **release candidate** of the
    next stable DOSBox Staging version.

    What is a "release candidate"? You can think of it as a "sneak preview" of
    our upcoming release before the full round of internal testing has been
    completed. As such, it might contain the occasional bug or regression,
    but it should be free of any serious showstoppers.

    Community feedback is crucial in discovering problems in any sufficiently
    complex software. The release candidates are aimed at experienced early
    adopters who are willing to help us stabilise our software for the final
    release. If you've run into any issues, please [report them to
    us!](http://127.0.0.1:8000/dosbox-staging.github.io/get-involved/#report-an-issue)

    Regular users who prefer a straight-line progression from one release to
    the next are advised to wait for the final stable release which should
    normally come up to 2 months after the release candidate.



## Summary

Hey DOS enthusiasts! We are proud to present DOSBox Staging 0.81.0 to you, a
rather substantial release containing a large number of exciting new features
and improvements!

For the first time in history, DOSBox comes with a built-in authentic CRT
monitor emulation that just works out-of-the-box without any manual
configuration required. The VGA code has been overhauled, shortcuts and
simplifications have been removed, and now we're defaulting to accurate
per-scanline emulation and double scanning in all VGA, SVGA, and VESA modes.
Integer scaling options have been added, it's now possible to stretch the
image to fullscreen or to force any arbitrary aspect ratio, or to even emulate
the horizontal and vertical stretch controls of CRT monitors in real time.
Screenshots have been made aspect ratio correct by default, and image
capturing became multi-threaded, so it no longer causes audio hiccups and
micro-pauses. Oh, almost forgot: we've also added 3dfx Voodoo support for
the fans of those late-90s 3D DOS games! And made that multi-threaded
too :sunglasses: :metal:

Well, that's just the video side of things. We've added support for the
ultra-rare IBM Music Feature Card, the MT-32 ROM setup has become much easier,
plus we've made numerous MIDI related improvements as well. Not to mention all
the mouse and joystick enhancements and fixes, the addition of a few missing
DOS commands, improved FAT filesystem integration, fixing some long-standing
annoying shortcomings of the FPU emulation in non-x86 builds, taking
localisation support to the next level, and the list just goes on and on...

Read on to learn more, and merry Christmas! üéÖ üéÅ üéÑ


## How to upgrade

Start by downloading the latest version, then make sure to upgrade your
primary configuration as described below.

### Downloads

<div class="compact" markdown>

- [Windows](../windows.md)
- [macOS](../macos.md)
- [Linux](../linux.md)

</div>


### Upgrading your primary configuration

Since config settings might be renamed, altered, or deprecated between
releases, it's best to let DOSBox Staging write the new default primary config
on first launch, then reapply your old settings manually.

Start by backing up your existing primary config file. This is where to find
it on each platform:

<div class="compact" markdown>

| <!-- --> | <!-- -->
|----------|----------
| **Windows**  | `C:\Users\%USERNAME%\AppData\Local\DOSBox\dosbox-staging.conf`
| **macOS**    | `~/Library/Preferences/DOSBox/dosbox-staging.conf`
| **Linux**    | `~/.config/dosbox/dosbox-staging.conf`

</div>

After this, simply start the new release---a new `dosbox-staging.conf` will be
written with the new defaults to the above locations.

!!! note "Portable mode notes"

    In portable mode, `dosbox-staging.conf` resides in the same folder as your
    DOSBox Staging executable. The migration steps for portable mode users are
    as follows:

      - Unpack the new version into a _new_ folder (this is important)
      - Create a new _empty_ `dosbox-staging.conf` file in the new folder to
        enable portable mode
      - Launch the new version

    DOSBox Staging will write the new defaults to the empty
    `dosbox-staging.conf` file. After this, you carry over your settings from
    the old primary config manually.


## New getting started guide

Due to popular demand, a brand new [getting started
guide](../../getting-started/introduction.md) has been added to the front
page. The guide will teach you how to set up your own DOSBox Staging
environment from scratch through easy-to-follow instructions with lots of
pretty pictures. It adopts a a learn-by-doing approach to ensure you'll have
fun while setting up some famous classic DOS games.

Although it's primarily intended for beginners, we guarantee even the most
experienced DOSBox users among you will learn a few interesting tricks from it!


## Graphics

### Authentic adaptive CRT emulation

We are happy to announce that we've removed all CRT shaders previously bundled
with our releases.

Every single one of them.

_What the @^$*%#!!!?? Have these guys gone mad??!_

The reason for removing them is that they got replaced with something far
better: a set of no less than **24 CRT shaders** tweaked to perfection to
emulate the glorious CRT monitors of the past, including authentic
recreations of Hercules, CGA, monochrome CGA, composite CGA, EGA, and VGA
monitors.

24 new CRT shaders sound a lot‚Äîhow will someone not intimately familiar with
CRT monitor technology and PC history know which is the best for a particular game? Well, the
good news is you don't need to know‚ÄîDOSBox Staging will automatically pick the
most appropriate one based on the current video mode and viewport resolution.
High-DPI and displays from 720p to 4k resolutions are fully supported, and
absolutely no manual configuration is required!

The following magic `glshader` options have been introduced:

- `crt-auto` ‚Äî This is the new default---an adaptive CRT shader that
  prioritises developer intent and how people experienced the game at the
  time of release. This means VGA games will be double-scanned, like on a real
  VGA monitor, EGA games will appear single-scanned with "fat scanlines", and
  so on, regardless of the `machine` setting.

- `crt-auto-machine` ‚Äî This one emulates a fixed CRT monitor
  based on your `machine` setting. So CGA and EGA modes on a VGA machine will
  always appear double-scanned with big chunky pixels, just like on a real VGA
  adapter and monitor.

- `crt-auto-arcade` ‚Äî This fantasy option does not exist in real life, but it
  can be a lot of fun! It emulates a 15 kHz arcade or home computer monitor
  with thick scanlines in low-resolution modes. Perfect for playing DOS VGA
  ports of Amiga and Atari ST games to experience them with MT-32 or SC-55
  sound from a strange parallel universe! üòé

Adaptive CRT shaders work in tandem with the new [integer
scaling](#integer-scaling) feature to achieve the most optimal results. The
default `auto` setting for `integer_scaling` auto-enables vertical integer
scaling for the adaptive CRT shaders; this avoids unwanted interference
patterns that can result from non-integer vertical scaling ratios.

**TODO image**

If you don't like CRT shaders, no problem---simply set `glshader` to `sharp`
in your config to regain your sharp little rectangles back. Naturally, you can
continue to use regular GLSL shaders like before. The deprecated CRT shaders are still available as a [separate download](TODO), should you need them.

!!! note "Why the old CRT shaders were removed"

    One problem with the previously bundled CRT shaders was that they lacked
    proper documentation, so it wasn't clear which shader was meant for what
    monitor resolution (some were tuned for 1080p, some for 4k, etc.)
    Moreover, most were designed to emulate arcade monitors or TV sets from
    the 80s and early 90s; these displays had very different characteristics
    than the much higher quality PC monitors. Because of all this, many people
    were rather unimpressed by them and gave up on CRT shaders altogether as a
    result.


### More accurate video emulation

Previously, DOSBox rendered the emulated VGA output without double scanning,
and only in quarter-frame chunks. These optimisation steps were probably
necessary 20 years ago, but now we're doing proper double scanning and
accurate per-scanline rendering in all VGA, SVGA, and VESA video modes.
It turns out this only causes a ~7% performance drop on modern hardware, which
is not much to ask for such a significant improvement.

Double scanning and per-scanline rendering was available via the special
`vgaonly` machine type before, but that was incompatible with VESA modes and
it truncated the 18-bit VGA DAC colour output to 16-bits only, causing banding
in certain scenes. We no longer do that; VGA output is always rendered at the 
full 18-bit precision.

These improvements have made the `vgaonly` machine type redundant, so it has
been deprecated (it's still recognised, but it's an alias for
`svga_paradise`). 

Additionally, all CGA, PCjr, and Tandy text modes are now properly
single-scanned when using their respective machine types. A few CGA, PCjr and
Tandy graphics modes appeared with the incorrect aspect ratio previously;
these have also been fixed.

The logging of video modes has become a lot more accurate; now we're
consistently logging the video standard the mode first appeared in (e.g., CGA
modes should be always CGA, regardless of the emulated display adapter in
use), and the logged pixel aspect ratios are always correct.

**TODO image**


### 3dfx Voodoo 1 emulation

Aaron Giles' 3dfx Voodoo emulation originally written for the MAME project has
finally found its way into Staging. During its journey, it has picked up a few
enhancements, namely a few changes by **kekko** for the DOSBox integration,
plus some multi-threading improvements by Bernhard Schelling (also
known as **psyraven**).

We've added support for emulating a Voodoo 1 board with either a 2 MB Frame
Buffer Interface (FBI) and one 2 MB Texture Mapping Unit (TMU), or a 4 MB FBI
+ dual 2x4 MB TMU configuration.

This is a purely software-based emulation; we don't support any OpenGL
passthrough. The default refresh rate for the Voodoo is 60 Hz, but it's
possible to force any custom refresh rate via `dos_rate`.

Please refer to the new `[voodoo]` config section to learn more.

**TODO image**


### Integer scaling

A new `integer_scaling` setting has been introduced to constrain the
horizontal or vertical scaling factors to integer values when upscaling the
image to fit it into the viewport. For example, you can enable vertical
integer scaling now with the following config:

```ini
[render]
integer_scaling = vertical
```

The correct aspect ratio will always be maintained, so in this case the
horizontal scaling factor might become fractional. With the `sharp`
shader this is not a problem as the "interpolation band" can only be up to 1-pixel
wide at the two sides of the pixel---still plenty sharp, especially on 1440p or
4k. Then with the CRT shaders, non-integer horizontal scaling matters even less; it's practically a non-issue.

`integer_scaling` is set to `auto` by default which only enables vertical
integer scaling for the adaptive CRT emulation, otherwise it's disabled.

This replaces the so-called "pixel-perfect mode" (`openglpp` and `texturepp`
output modes) which prioritised 100% sharp pixels at the expense of aspect
ratio correctness. That feature had been the source of endless confusion even
among experienced users as usually it could only _approximate_ the correct
aspect ratio, and even that varied semi-randomly based on the current viewport
size and monitor resolution. Our reasons for removing the "pixel-perfect mode"
are documented in detail
[here](https://github.com/dosbox-staging/dosbox-staging/issues/2448).


### Aspect ratio correct image captures

Previously, even if you had aspect ratio correction enabled, the captured
screenshots always contained the raw, non corrected image. This has been
flipped around: the new default is capturing images in the same aspect
ratio that you see on your screen.

Taking raw and rendered (post-shader) screenshots continues to be an option,
of course. The following three image capture formats have been introduced:

- `upscaled` ‚Äî The image is captured in the same aspect ratio that you seen on
  the screen. Upscaled captures always use sharp pixels, regardless of the
  shader in use.

- `rendered` ‚Äî Capture the post-rendered, post-shader image---an exact
  pixel-by-pixel replica of what you seen on the screen.

- `raw` ‚Äî Capture the raw image; this always results in square pixels. So
  for 320&times;200 VGA or EGA content you'll always get a 320&times;200 PNG
  file, no matter what.

You can configure the capture formats of the default screenshot action with
the following setting:

```ini
[capture]
default_image_capture_formats = upscaled raw
```

With this setting, two PNG files will be written in raw and upscaled formats
whenever you press the ++ctrl+f5++ screenshot hotkey (++cmd+f5++ on macOS).

Keybindings for taking single screenshots in specific formats are also
available.

!!! note "Interpolation in upscaled mode"

    The image is integer or bilinear-sharp upscaled to around 1200 pixels of
    vertical resolution in the new `upscaled` capture mode.  For example:

    - 320x200 content is upscaled to 1600x1200 (5:6 integer scaling)
    - 640x480 to 1920x1440 (3:3 integer scaling)
    - 640x350 to 1400x1050 (3x vertical and 2.1875x horizontal scaling)

    The resulting PNG files are only about 30% bigger compared to raw
    screenshots on average. This is a rather small price to pay for aspect
    ratio correctness.


!!! important "Aspect ratio correctness, 2023 edition"

    Fact: most 320&times;200 and similar low-resolution DOS games _absolutely
    need_ aspect ratio correction enabled to appear correctly. While some
    games benefit from forcing square pixels, these only account for about
    1-2% of the total DOS gaming catalogue. That's the reason why DOSBox
    Staging performs aspect ratio correction out-of-the-box.

    The sad reality of the situation today is that the vast majority of
    320&times;200 DOS games are displayed in the wrong aspect ratio with
    square pixels on various websites and video-sharing services. Emulators
    that don't default to aspect ratio correct output and screen captures have
    undoubtedly contributed to this widespread problem. Aspect ratio correct
    screen captures by default is our attempt to play our part in remedying
    the situation, and hopefully reversing it with time.


### Multi-threaded image capturing

Image capturing is now being performed in multiple background threads. This
eliminates emulation micro-pauses and sound glitches even when rapidly
spamming the screenshot hotkey. This was especially a problem with rendered
post-shader screenshots on 4K monitors even on fast modern hardware.


### Aspect ratio and viewport enhancements

Stretching the image to completely fill the screen has been an often requested
feature (e.g., to play text adventures without black bars on the sides). Now
we're giving you not only that but an entire new mechanism to apply arbitrary
aspect ratios, zoom into the DOS content, and even emulate the horizontal and
vertical stretch controls of CRT monitors of yore! :sunglasses:

The key element of the feature is the new `aspect = stretch` mode which
stretches the image to the extents of the viewport. For example, to make a
game completely fill the screen, use the following config:

```ini
[sdl]
fullscreen = on

[render]
aspect = stretch
viewport = fit
integer_scaling = off
```

The second piece of the puzzle is the new `relative` mode added to the
`viewport` setting (`viewport_resolution` has been renamed to `viewport` and
moved to the `[render]` section). In relative mode, the viewport is a 4:3
aspect ratio rectangle fit into the window or screen as the starting point,
which is then scaled by the specified horizontal and vertical stretch factors.
The resulting viewport is allowed to extend beyond the edges of the window or
the screen, so this can be used to "zoom" into the image while forcing
arbitrary aspect ratios.

For example, you can aspect ratio correct lazy Hercules conversions that just
reused the EGA/VGA assets and make them fill the screen better by zooming in a
little. The following example illustrates this on Prince of Persia in Hercules
mode:

```ini
[render]
aspect = stretch
viewport = relative 112% 173%
integer_scaling = off
```

**TODO image**

Captions:

1. Prince of Persia without any custom stretching

2. Prince of Persia with `aspect = stretch` and `viewport = relative 110% 160%`


### Fix black vertical bars video corruption issue

This is a fix for the "black vertical bars" video corruption issue seen on a
few late-90s games and demos that require Pentium CPUs. Due to some fairly
intricate technical details to do with 80-bit x87 FPU emulation, the issue
does not manifest in 32-bit x86 builds, but it does in all other builds on all
platforms (including 64-bit x86 builds).

A non-exhaustive list of affected programs:

Games:

<div class="compact" markdown>
- [Carmageddon (1997)](https://www.mobygames.com/game/367/carmageddon/)
- [Motor Mash (1997)](https://www.mobygames.com/game/57275/motor-mash/)
- [Peter Sampras Tennis (1997)](https://www.mobygames.com/game/7250/pete-sampras-tennis-97/)
</div>

Demos:

<div class="compact" markdown>
- [Sunflower by Pulse (1997)](https://www.pouet.net/prod.php?which=85)
- [Multikolor by kolor (1997)](https://www.pouet.net/prod.php?which=861)
- [toontown by kolor (1997)](https://m.pouet.net/prod.php?which=315)
</div>

**TODO image**


### New deinterlacing shader for FMV games

Schlocky 90s FMV titles are the guilty pleasure of every true retro-gamer
(we're no different, so zero judging!) Unfortunately, many of these games are
plagued by a weird trick: the video footage is often displayed with
alternating black "interlace lines". This just doesn't look very good on
modern ultra-sharp flat screens, and upscaling such content with non-integer
scaling ratios often causes very ugly interpolation artifacts.

To restore cosmic balance, we've introduced a pair of "deinterlacing" shaders,
building upon the work of Ove Kaaven:

- `misc/fixvideo` --- This intelligently doubles scanlines that have a black
  line beneath them. Works well with non-integer scaling ratios.

- `misc/fixvideo-scanlines` --- Similar to the first one, but this retains a
  subtle scanlined look to improve the "perceptual resolution" of the video
  footage. This one absolutely needs vertical integer scaling enabled!

**TODO image**

Now you can enjoy your 90s FMV shlock in their full gory glory! :sunglasses:



### Other graphics related changes

- OpenGL pixel buffer object support was dropped to enhance performance and
  efficiency. This will result in reduced energy use, reduced thermal load,
  and significantly improved performance on single-board computers, Intel HD
  Graphics, and AMD APUs.

- The keymapper now supports high DPI screens.

- A new `interpolation/catmull-rom` shader has been added. This implements an
  upscaling method that looks better than the bilinear interpolatin option you
  get with the `none` shader.

- Various monochrome mode fixes & improvements affecting Hercules and
  monochrome CGA emulation. Most notably, the manual "bright mode" hotkey to
  toggle between the two monochrome palette variants has been removed. Now the
  appropriate palette is auto-selected based on whether we're in a text or
  graphics mode.

- A corner case delayed display regression was fixed in VFR presentation mode.
  The presentation mode auto-selection criteria has also been refined to
  achieve optimal results with a wider range of monitor, driver, and operating
  system combinations.

- The legacy `surface` output mode has been removed. The new fallback option
  is the `texture` output mode that automatically selects an accelerated or
  non-accelerated rendering backend based on availability via SDL. The
  preferred and recommended output mode is still OpenGL, as it always has
  been.


??? note "Full PR list of graphics related changes"

    - (S)VGA/VESA square pixel mode fix/cleanup (#2583)
    - Adaptive CRT shader compatibility fixes for really old GPUs (#3172)
    - Adaptive shader fixes (#2866)
    - Add `crt-auto-arcade-sharp` adaptive CRT shader (#3083)
    - Add `misc/fixvideo.glsl` OpenGL shader (#2442)
    - Add crt/aperture.mono shader variant (#2393)
    - Add new glshader/misc dir to the Meson build (#2443)
    - Add support for disabling screen via the clocking mode register, fixes #2838 (#2842)
    - Always log OpenGL shader and program info logs if they're non-empty (#3121)
    - Aspect ratio and viewport improvements (#3124)
    - Authentic adaptive CRT shaders (#2777)
    - Auto-disable the integer scaling feature if the image is smaller than‚Ä¶ (#2588)
    - Capture modularisation/cleanup (#2451)
    - Change VESA BIOS branding to 'DOSBox Staging' (#2712)
    - Clean up OpenGL attribute init (#3111)
    - De-SDL voodoo threading (#2568)
    - Deprecate machine type `vgaonly` (#2398)
    - Disable framebuffer acceleration for debugger (#2477)
    - Don't auto-disable OpenGL for debugger-enabled builds on Linux (#2480)
    - Don't restrict text video modes to the VFR presentation mode (#2286)
    - Double-scanning support for VESA modes, accurate mode change logging, `vga_draw.cpp` rework & many other improvements (#2654)
    - Drop OpenGL PBO support (#3099)
    - Enable vsync by default (#2373)
    - Fix "-fullscreen" argument on Wayland (#2688)
    - Fix CGA composite regression (#2662)
    - Fix Tandy support for Ninja (1986) (#2225)
    - Fix VESA 256 / 8-bit in Windows 3.1 (#2569)
    - Fix a couple aspect ratios (#2612)
    - Fix a couple issues from the `vgaonly` PR (#2424)
    - Fix a crash when using `glshader = crt-auto-machine` (#3077)
    - Fix a window size regression on macOS (#2374)
    - Fix altered shader pragmas not taking an effect when reloading the shader (#2736)
    - Fix comment describing BGRX8888 PixelFormat (#2766)
    - Fix compilation failures on *BSD and colour rendering on big-endian platforms (#3155)
    - Fix const issue writing a png with png12 (#2740)
    - Fix double-scanning & pixel-doubling handling in `openglnb` output mode (#3092)
    - Fix fallback shader scaling for adaptive CRT shaders (#2840)
    - Fix flicker in some games due to mouse driver breaking double buffering (#2867)
    - Fix image capture indices always starting from 1 (#2656)
    - Fix incorrect pixel aspect ratio calculation for all text modes (#2570)
    - Fix invalid default config value for voodoo_memsize (#2744)
    - Fix mapper screen for high dpi (#2708)
    - Fix raw image & video capture for 160x200 16-colour Tandy/PCjr modes  (#3185)
    - Fix raw video capture so it always writes non-double-scanned raw output (#3177)
    - Fix regression in Build Engine games (3Dfx mode) (#2432)
    - Fix regression in VGA draw's wrapped line case (#2441)
    - Fix regression in palettized VGA line draw function (#2491)
    - Fix regressions in some video modes' aspect and line-counts (#2445)
    - Fix sRGB GLSL pragmas (#2665)
    - Fix spelling mistakes in 'voodoo_*' config descriptions (#2859)
    - Fix the aspect ratio of 40-column 00h and 01h BIOS text modes (#2852)
    - Fix the calculation of vga.draw.lines_scaled when double scanning (#2806)
    - Fix vertical bars due to FILD/FIST memcpy trick (#3151)
    - Fixes and cleanup of PCI BIOS (#2731)
    - Force OpenGL renderer backend for keymapper (#2768)
    - Give Voodoo a gentle push to get it passing CI (#2710)
    - Ignore extensions when finding highest capture index (#2946)
    - Image capture enhancements mega-PR ‚Äî Godzilla Edition¬©¬Æ‚Ñ¢ ü¶ñ (#2503)
    - Implement Voodoo usability fixes (#3103)
    - Implement integer viewport scaling (#2456)
    - Improve the "mode 1" deinterlace method (#3192)
    - Include low width resolution in VGA scanning citeria (#2582)
    - Introduce PixelFormat enum (#2735)
    - Let the VESA 8-bit mode draw lines from the DAC palette (#2494)
    - Limit consecutive duplicate frames in VFR presentation mode (#3004)
    - Make triangle_worker members threadsafe (#2434)
    - Minor voodoo performance tweaks (#2435)
    - Monochrome mode fixes & improvements (#2769)
    - Only capture the visible image in rendered image capture mode (#3194)
    - Perform console cursor and text calls via interrupt (#3113)
    - Port Voodoo support with multi-threaded software backend (#2410)
    - Present VFR duplicate frames on a tempo (#2379)
    - Refine when `presentation mode = auto` uses throttled mode (#2818)
    - Reload shader fixes (#2730)
    - Remove scan and pixel doubling config settings (#2728)
    - Rename PixelFormat enum members BGR555 and BGR565 to RGB555 and RGB565 (#2823)
    - Rendering related refactorings (#2739)
    - Replace busy-wait atomic bool goto logic (#2545)
    - Resize VGA within half the current frame-time (#2510) (#2528)
    - Restore authentic text mode pixel aspect ratio calculation (#2625)
    - Retire surface output (#2780)
    - Simplify and improve `presentation_mode` handling (#2690)
    - Simplify double-scan criteria and let users `'force_vga_single_scan'` w/ conf option (#2428)
    - Update Catmull-Rom shader (#2786)
    - Video related refactorings (#2808)
    - Window sizing improvements & aspect ratio related cleanup (#2749)
    - `crt-auto` should auto-switch to VGA shaders in EGA modes with 18-bit VGA palettes (#2819)
    - `sdlmain` improvements (#3123)


## Sound

### IBM Music Feature Card support

IBM Music Feature Card is a rare and expensive sound card from the late 1980s.
It is mainly supported in early Sierra SCI games and a few others, like
Silpheed. Thanks to Loris Chiocca for authoring this originally!

TODO video


### MT-32 ROM detection improvements

- Load MT-32 ROMs from `romdir` using hash matches  (#2591)
- Rework the MT-32/CM-32L ROM lookup and `MIXER /LISTMIDI` improvements (#3011)


### MIDI mute improvements

- MIDI mute improvements (#2318)


### Sanitise raw MIDI output

- Sanitise raw MIDI output by default & add `raw_midi_output` config option (#2308)


### Option to fade out hanging notes on Tandy & OPL

Games like **Bard's Tale Construction Set** and **California Games II** suffer
from an issue of hanging notes due to the games writing to the port without
terminating them. DOSBox Staging now allows an option to quiet down those port
writes with a fade out timer.

- Add a fade-to-sleep-after-last-port-write feature to the mixer (#3058)


### Fix MIDI portamento messages on FluidSynth

Roland SC-55 and FluidSynth handle MIDI portamento messages very differently,
which would result in warped tones in a few games like Descent. With MIDI
portamento messages not being passed to FluidSynth the sound is closer to the
Roland SC-55.

- Do not send portamento messages (MIDI CC 5, 65 & 84) to FluidSynth (#2705)


### More flexible Tandy sound support

This makes it easier to play your games with Tandy sound, as DOSBox Staging
doesn't have to be booted up as the Tandy 1000. DOSBox Staging also
reinitialises the DAC every time Tandy sound is switched on to make sure
digital audio in games like Space Quest 3 is played back.


### CD-ROM seek delay emulation

DOSBox Staging now simulates CD-ROM seek delay more accurately to fix the CD
audio in a few games. For example, this fixes **Chasm: The Rift** that stopped
playing the music after 20 minutes of gameplay previously.


### CD Audio support on Linux

Implement CD Audio using Linux ioctls

- Implement CD Audio using Linux ioctls (#2675)


### Other sound related changes

- Ignore speaker-output enable/disable commands on the SB16 (#3105)
- MIXER command improvements & general mixer enhancements + fixes (#2868)
- Un-deprecate the per-SoundFont volume scaling (#2677)
- Fix a GUS regression when interpolating 16-bit samples (#2576)


??? note "Full PR list of sound related changes"

    - Accumulate GUS frames accross each voice instead of per-sample (#2696) (#2698)
    - Add Loris Chiocca's IBM Music Feature Card (IMFC) patch  (#2367)
    - Add `iir` to the set of MSYS2 packages (#2242)
    - Add a fade-to-sleep-after-last-port-write feature to the mixer (#3058)
    - Always clamp 'frames_needed' to the allowed mix/max range in the mixer (#2843)
    - Clamp the max Sound Blaster 16 sample rate to 45454 Hz, not 45000 Hz (#2676)
    - Cleanup the GUS and SB DMA channels on close (#2585)
    - Consistently cast and wrap the mixer's position (#2745)
    - Do not send portamento messages (MIDI CC 5, 65 & 84) to FluidSynth (#2705)
    - Don't rename the CMS mixer channel to GAMEBLASTER when `sbtype` is `gb` (#2228)
    - Drop volatile members in IMFC and reSIDfp (#2380)
    - Extract MIXER command into its own file (#2839)
    - Fix MIDI capture (#2707)
    - Fix Sound Blaster DMA ADPCM frame count assertion error (#2277)
    - Fix a Coverity warning in SDL Sound (#3000)
    - Fix a GUS regression when interpolating 16-bit samples (#2576)
    - Fix a couple regressions in `main` relating to MIDI refactoring (#2541)
    - Fix duplicate SoundFont listing in mixer /listmidi (#3074)
    - Fix spurious directory separators in `mixer /listmidi` output (#2383)
    - Fix state handling of the BIOS's Tandy DAC callbacks (#3148)
    - Fix the priority of the "set decibel volume" MIXER command (#3068)
    - Ignore speaker-output enable/disable commands on the SB16 (#3105)
    - Implement CD Audio using Linux ioctls (#2675)
    - Improve MIDI buffer underrun logging (#2227)
    - Let derived CDROM devices asynchronously lag their calls (#2622)
    - Let only one device reserve a DMA channel at a time (#2593)
    - Link mt32emu statically in the MSYS2 CI release (#2711)
    - Load MT-32 ROMs from `romdir` using hash matches  (#2591)
    - Lookup MT-32 ROMs using std::filesystem paths (#2387)
    - MIDI mute improvements (#2318)
    - MIXER command improvements & general mixer enhancements + fixes (#2868)
    - Minor string fixes in MIXER command (#3072)
    - Mixer refactoring & cleanup (#2787)
    - Only process MT-32 debug messages in debug builds (#3100)
    - Re-add the SDL Sound assert (third time's a charm?) (#3006)
    - Re-initialize the BIOS DAC callbacks on SB and Tandy changes (#3142)
    - Refill the SB audio channel when DMA reaches terminal count (#233) (#2614)
    - Rework the MT-32/CM-32L ROM lookup and `MIXER /LISTMIDI` improvements (#3011)
    - Sanitise raw MIDI output by default & add `raw_midi_output` config option (#2308)
    - Sync Nuked-OPL3 with upstream (#3015)
    - Sync YM1728B_emu with upstream (#3021)
    - Sync fluidsynth, glib, gtest, libjpeg-turbo, and mt32emu wraps (#2991)
    - Sync reSIDfp with upstream (#3067)
    - Sync residfp with 2.4.2 (#2259)
    - Try again to fix Coverity warning in SDL Sound (#3005)
    - Tune the IBM Music Feature card's 0-dB level and default filter  (#3048)
    - Un-deprecate the per-SoundFont volume scaling (#2677)


## Input


### Virtual joystick fixes

Virtual joysticks can now be created without a physical joystick being plugged
in. This fixes a regression introduced early in DOSBox Staging development,
which now allows mapping keyboard events to joystick events. The deactivation
logic of the pressed key now detects when the key is not being pressed
anymore---this improves joystick support in 74 games.

### Mouse improvements

The PS/2 mouse port is now emulated at the register level, and more PS/2
protocol commands are now supported. This allows the emulation of fairly
complex input devices like the Microsoft IntelliMouse Explorer with 5 buttons
and a mouse wheel on Windows 95.

- It is now possible to disable built-in emulated mouse driver and use your
  favourite real DOS driver.
- Fixed mouse support in MS Word 5.5 for DOS
- Fixed problems with internal mouse driver and certain screen modes above 80 columns
- On multi-display hosts, it is now possible to release the captured mouse or use seamless mouse integration in fullscreen mode
- Microsoft IntelliMouse Explorer (5 buttons + wheel) mouse is now emulated

### Support for mapping mouse buttons to keyboard keys

Some games like **Settlers I** (also known as **Serf City: Life is Feudal**)
require the player to push both mouse buttons at the same time to perform
certain actions. This is impossible to perform on some input devices such as
the Apple MacBook trackpad or the ChesterMouse. This has now been fixed by
allowing mouse buttons to be mapped to the keys of the keyboard as a
workaround.

### Multi-monitor-aware mouse capture support

DOSBox Staging now has fully multi-monitor-aware mouse capture. When
multi-monitor awareness mode is enabled, switching to full screen does not
automatically capture the mouse. In full screen mode, it is possible to
release the mouse. Seamless capture works in full screen mode, allowing you to
freely move the mouse cursor between the monitors.

### macOS function key support

macOS users can now force the Touch Bar or media keys to operate as function
keys when using DOSBox Staging (this will not affect other apps or the OS).
Instructions on how to set this up can be found in the DOSBox Staging Wiki:
(https://github.com/dosbox-staging/dosbox-staging/wiki/Tips-&-tricks#force-touch-bar-or-media-keys-to-operate-as-function-keys-when-using-dosbox-staging-on-macos)

### VirtualBox mouse protocol improvements

Installing Javis Pedro's VirtualBox driver
(https://git.javispedro.com/cgit/vbmouse.git/about/) allows seamless
integration of the Windows 3.1x environment into your host OS by making sure
the mouse tracks exactly the same inside Windows 3.1x as in the host operating
system. The mouse cursor will seamlessly track over DOSBox Staging window
edges.

### Brazilian ABNT2 keyboard support

The mapper, keyboard, and BIOS tables are expanded to handle the OEM102 and
ABNT1 keys found on Brazilian ABNT2 keyboards. The left and right Windows
keys are given their correct scan codes (91 and 92).


??? note "Full PR list of input related changes"

    - Add extra hotkey button row in the mapper (#3147)
    - Add mouse button mapping community patch (#3078)
    - Add multi-monitor awareness mode for mouse capture (#2377)
    - Create and update joy binds even when physical joysticks aren't present (#2516)
    - DOS mouse driver fixes (#2601)
    - Fix compatibility problems with VBADOS (VBMOUSE.EXE) mouse driver (#2742)
    - Fix deactivation of queued joystick axis movement (#2713)
    - Fix joysticks breaking after a config -set (#2694)
    - Fix memory access in VirtualBox device, enable VirtualBox mouse protocol (#3089)
    - Fix mouse centering on high DPI displays with scaling enabled (#2611)
    - Fix mouse movement limitation regression in some games (#2648)
    - Fix mouse problem with windowed mode and viewport_resolution setting (#2333)
    - Fix problem with some software (like MSD.EXE) displaying garbage mouse driver info (#2538)
    - Fix register-level PS/2 mouse access when DOS mouse driver is disabled (#3120)
    - Fix the scan code sequence for the `pause` key (#2498)
    - Handle OEM102 and ABNT1 keyboard scancodes (#2209)
    - Implement DOS mouse driver function 0x32 (#2508)
    - Implement i8042 diagnostic dump (#2298)
    - Improve `mouse_sensitivity` behavior (#3138)
    - Improve i8042 emulation, fix KEYB.COM (#2293)
    - Improve text mode detection in DOS mouse driver (#2658)
    - Keyboard rework and PS/2 mouse register-level access support (#2287)
    - Minor cleanups in mouse and keyboard emulation code (#2230)
    - Only unmute / unpause when Window focus is gained (#2254)
    - Pause fixes (#2323)
    - Port keymapper to SDL renderer (#2763)
    - Prefer evdev mouse API over xinput on Linux (#2529)
    - Release mouse if `config -set mouse_capture=nomouse` is executed (#3129)
    - Reset DOS mouse driver position granularity on every mode change (#2608)
    - Reworked virtual machine mouse support (#2755)
    - Workaround for keyboard problem in Ultima VIII: Pagan (#3109)


## DOS integration

### Command-line user experience improvements

We listened to our users and improved the command-line user experience. Every
option has been looked at critically; text descriptions have been rewritten,
and some old options have been removed that are not applicable to the current
state of the software. All behaviour is still backwards compatible to ensure
smooth operation with old batch files and shell scripts.


### New FOR command

The missing `FOR` command has been added, resulting in better software
compatibility with batch files that contain loops. The behavior mirrors the
behaviour of the MS-DOS 6.22 `FOR` command.


### Various DOS command additions and improvements

- The missing `MOVE`, `TREE`, `SETVER`, and `VOL` commands have been added.
- The `CLS` command now does not reset the screen mode to 80&times;25.
- The verbosity of the `DELETE` command has been improved.
- The wildcard handling of the `IMGMOUNT` command has been improved.
- The `LS` command now accepts multiple paths or patterns and ignores hidden
  or system files unless the `/A` switch is specified.
- The `MEM` command now supports XMS memory capacities over 64 MB and has a
  critical bug fixed where it consumed all upper memory blocks after on
  invocation.
- The `MORE` command is now extended with features from modern Windows.


### Persistent command line history

The emulated DOS shell now retains a 500-line history of your previous
commands. The history is remembered across multiple sessions, just like you
would expect it from a Linux shell.


### Support for all DOS file & directory attributes

All DOS file and directory attributes are now supported:

- On Windows, the attributes are stored as standard filesystem attributes
- On macOS and Linux, they're stored as mixture of standard attributes (for
  the read-only flag) and extended `xattr` attributes. The extended attributes
  follow the Samba 3 format which is compatible with WINE and DOSEmu2.


### Autoexec improvements

Several long-standing `[autoexec]` related issues have been fixed:

- The `[autoexec]` section in config files is now fully UTF-8 aware and its
  contents is now converted to the internally set code page on the fly.
- The size limitations of the `[autoexec]` section have been lifted.
- The generated `Z:\AUTOEXEC.BAT` is now prettier due to the added extra comments.
- The `CONFIG -wc` command does not eat away empty lines from the `[autoexec]`
  section anymore.


### Optional shell config shortcuts

The command line shortcuts for displaying and setting config options can now
be disabled via the `shell_config_shortcuts` setting (e.g., instead of `config
-set sbtype sb16`, you can simply use the `sbtype sb16` shortcut).

This might be useful in some situations where the config shortcuts conflict
with DOS commands (although DOS commands always takes precedence in case of a
name clash, so the risk is low).

??? note "Full PR list of DOS integration changes"

    - Add FOR Command (#3094)
    - Add full file path printing for file related debugger commands (#2472)
    - Add short prompts for MORE commands for 40 column screen modes (#2953)
    - Auto enable shell variable expansion for DOS >=7 (#2378)
    - Autoexec fixes (#3007)
    - Cleanup AUTOEXEC.BAT generation (#2609)
    - Disable writing command line history if entry is empty (#2635)
    - Do not discard empty lines in `[autoexec]` section (#2415)
    - Do not write SETVER table back to file if secure mode is engaged (#2623)
    - Don't block r/w file opens on r/o FAT images (#2280)
    - Don't save command history to current working directory (#2630)
    - Enable large disk image support (#2301)
    - Exclude COMMAND.COM's help arguments when part of sub-command (#2263) (#2264)
    - FAT image mounting fixes (#2278)
    - FCB argument regression fix (#2524)
    - File attribute support improvements (#2961)
    - Filesystem fixes (#2288)
    - Fix MSCDEX regression in game "Fascination (1991)" (#3163)
    - Fix alignment of file size column in the DIR command's output (#2799)
    - Fix batch file 'goto' for previous labels (#2384)
    - Fix bug where DTA can be modified by DELETE command (#2653)
    - Fix drive automounts (#3038)
    - Fix file creation regression on case sensitive file systems (#2971)
    - Fix for DOS error code being wrongly set on creating files (#2989)
    - Fix lockup involving specific mount order (#2310)
    - Fix mounting directory with space in its name, passed as an argument (#2626)
    - Fix read checks in shell file reader (#3076)
    - Fix unneeded empty lines in 'TREE | MORE' display (#2944)
    - Fixes for shell_misc.cpp regressions (#2517)
    - Ignore trailing colon in shell redirection (#2240) (#2446)
    - Implement DOS file/directory attributes support (#2951)
    - Implement MOVE shell command (#2660)
    - Implement SETVER.EXE command (#2464)
    - Implement TREE.COM command (#2366)
    - Implement persistent command line history (#2615)
    - Implemented VOL shell command (#2638)
    - Improve the help and output of the `CONFIG` command (#2672)
    - Improve the online help of the MORE command (#2947)
    - Improve verbosity of DELETE command (#2274)
    - Improve wildcard handling for `imgmount` file arguments (#2270)
    - Make MOVE and SUBST external commands (#2691)
    - Make shell configuration shortcuts optional/configurable (#2807)
    - Omit blank lines from command history (#2673)
    - Re-write CLS command to not change screen mode (#3024)
    - Re-write DOS_Shell::CMD_RENAME (#3126)
    - Rename command_history to shell_history, for consistency (#2640)
    - Rework and improve `LS.COM` command (#3034)
    - Skip processing of hidden host files (#2240)
    - Tab completion fixes for / and . (#2555)
    - Track and free allocations in MEM program (#2534)


## General

### CPU cycles handling improvements

- Don't throttle emulation speed when window becomes unfocused (#3085) This solves an issue I've been having where I get bad audio skips when the Dosbox window is unfocused. It turns out we're silently halving the CPU cycles.... Duke3D with FluidSynth music is the game I've found easiest to reproduce the audio skips as it needs all the cycles it can get. It also sometimes stops playing video frames all together when cycles get halved. I've also noticed audio skips in Space Quest 3 with MT32 sound.

- Restore sane `max N%` cycles behaviour where 100% means 100% (#3141) Previously, cycles = max or cycles = max 100% really meant 90% CPU core utilisation, and the rather hacky cycles = max 105% corresponded to about 95% actual utilisation. You could not go higher than that! This perhaps made some sense in the early 2000s when single-core CPUs were the norm to protect inexperienced users, but as since about 2010 onwards at least dual-cores became common, this is nothing more than some confusing legacy cruft. Even the quite old and underpowered Raspberry Pi 3B released in 2016 has a 64-bit quad-core ARM Cortex...

**Max 100% is now thread capacity 100% for optimum performance**

Previously, using the max 100% setting resulted in only 90% of the thread
capacity being used. Now DOSBox Staging uses the full 100% capacity of the
thread, resulting in similar or better performance versus the previous 0.80.1,
even with the new accuracy improvements. This also makes the main thread go
into oversubscription at times (over 100% capacity), resulting in a faster and
more aggressive boost clock ramp-up.

**Emulation isn't throttled anymore when the window becomes unfocused**

Throttling emulation in today's multitasking workflows becomes an issue if you
want to listen to the game music while you're doing something else, since this
would cause the music to skip. This also doubles the performance when running
longer tasks in the background, like compiling DOS programs with Open Watcom
C/C++.


### Config enhancements

Previously, the primary config was only written if it did not exist and no local config was present. This was super confusing and inconsistent behaviour that served no useful purpose whatsoever. It tripped me up several times and I never understood why the default config was written only sometimes‚Äîuntil now, but I had to read the code for that... This PR simply checks if the found config file is empty (or contains only whitespace). If so, re-create the config file as if it were not there.

- Boolean config param handling improvements & cleanup (#2354)
- Improve handling of deprecated settings and other setting related improvements (#3118)


### Modernised application icons

The new icons are compliant with modern OS interface guidelines and improve
legibility in small icon sizes. A custom icon has been added for macOS that
conforms to the Human Interface Guidelines with a rectangle with rounded
corners design.

### Pause feature improvements

The Pause function now operates on the same principle as the Mute function.
Pressing the hotkey turns on Pause, and pressing the hotkey again unpauses.
Alt+Pause remains the hotkey for Windows and Linux. macOS has a new hotkey
assigned as ‚åò Command-P.

- Restore pause on macOS & pause indicator in the window's title bar (#3140)


### Maximum memory space increased to 3 GB

The maximum XMS memory size has been increased from 63 MB to 3 GB. Windows
3.1x now allows more than 64 MB of RAM to be allocated.


### Modem improvements

The modem speed and port baud rate now match by default. This simplifies
things as there isn't a possibility for the modem and port speeds to
mismatch by default anymore. Modem speed is now reported in _bps_ (bits per
second) to differentiate it from _port speed_. This fixes Doom 1.2 as that
games mandates a modem speed of 9600 bps.


### FPU improvements

- Better software compatibility by allowing x87 stack overflow

Previously, DOSBox Staging would hard exit when faced with an x87 stack
overflow condition. Real DOS allowed the system to continue to run when faced
with an x87 stack overflow condition. We're now emulating DOS behaviour more
closely, which will improve compatibility with some demos like kkowboy.

- Intel Floating Point Conformance Test passes with 0 failures on the x86 hosts

The Intel Floating Point Conformance Test for IEEE 754-1985 now passes with 0
failures on hosts with the x86 family of CPUs on all the cores. The 80-bit
extended precision format is truncated to the 64-bit double precision format
on non-x86 hosts for performance reasons, and these hosts shouldn't be used
for any engineering or financial calculations.


- Fix FROUND Issues (#3161)
- Fix rounding when very close to an integer (#3149)
- Import FPU scale fix for x86 normal core (#2297)
- Quake does many floating point operations in single precision mode. This was causing issues in the FROUND FPU emulation function, since the double in parameter could easily exceed the precision of a float. After logging this function, I saw Quake often pass values like 5.9999999967 to be chopped in single precision mode, so was getting a value of 5.0 back. By casting to a float prior to the trunc, these cases get automatically handled correctly. On my M1 MacBook Pro system, at least, this has the nice side effect of boosting QTD by 5-7%.

- This is an experimental hack for #2404. When in ROUND_Chop mode on non-x64 platforms, if the input number is very close to, but less than, a whole integer, it gets chopped to the value below, e.g. 7.9999999994 will chop to 7 when it should be 8. This is only done when the FPU is set to extended precision mode, the assumption being that the number to chop, if that close to an integer, is inaccurate and would likely be the integer under full 80-bit precision.

- Never hard-exit DOSBox when an x87 FPU stack overflow is detected (#2564)
There's no good reason to take such a drastic measure as to hard exit DOSBox when an FPU stack overflow is detected. Real hardware does not do that; the FPU stack over/underflow just happens and sets the overflow bit that the application can optionally inspect and recover from it, etc. This can prevent programs that cause x87 stack over/underflows but recover from them later from running. I've run into one such example, see linked ticket with repro pack.


### Debugger improvements

- Add a memory read breakpoint feature to the builtin debugger (#3191)

**Linux debugger-enabled builds now have OpenGL enabled**

Debugger-enabled builds utilising the internal debugger now have OpenGL
enabled, which will make the debugger environment much faster to use and make
the environment more welcoming to anyone who likes to use this feature on
Linux.


### New & improved Linux man page

The man page is now fully rewritten. All the changes reflect improvements to
the command-line user experience. The new man page is shorter yet has more of
the information you would need by removing legacy entries. The new man page
received input from four people for improvements.


### DMA handling improvements

Let only one device reserve a DMA channel at a time
https://github.com/dosbox-staging/dosbox-staging/pull/2593


### FreeBSD, OpenBSD & PPC support

DOSBox Staging can now be used on FreeBSD and OpenBSD. The PPC dynarec core
has been broken for a while now; this has been fixed, and various endianness
issues have been rectified so now you can run Staging on big-endian PPC
processors without problems.


??? note "Full PR list of miscellaneous enhancements"

    - Add "Start DOSBox Staging (logging)" command to the macOS DMG image (#2352)
    - Add a memory read breakpoint feature to the builtin debugger (#3191)
    - Add higher res icons to meson install script (#3179)
    - Adjust ticksDone with render time (#3136)
    - Always write the primary config if it doesn't exist (#2966)
    - Boolean config param handling improvements & cleanup (#2354)
    - Change sdl.opengl.shader_source from std::string_view to std::string (#2753)
    - Convert SDLOSXCAGuard files to UTF-8 (#2982)
    - De-unionise X86PageEntry (#2994)
    - Do not set icon at runtime (#3171)
    - Don't throttle emulation speed when window becomes unfocused (#3085)
    - Enable loguru stack traces (#2652)
    - Fix FROUND Issues (#3161)
    - Fix rounding when very close to an integer (#3149)
    - Import FPU scale fix for x86 normal core (#2297)
    - Improve DOSBox Staging application icons (#3157)
    - Improve XMS emulation, based on code from DOSBox-X (#2386)
    - Improve handling of deprecated settings and other setting related improvements (#3118)
    - Increase max memory size to 3072 MB, minor cleanup (#2334)
    - Increase maximum memory size to 384 MB (256 MB+128 MB) (#2289)
    - Let `DriveManager` own all filesystem and image mount objects (#2306)
    - Logging & config description improvements (#2668)
    - Never hard-exit DOSBox when an x87 FPU stack overflow is detected (#2564)
    - Normalise Windows context menus created by the installer (#2355)
    - Normalise warnings messages (#3143)
    - Regenerate primary config file if it is empty (#3139)
    - Restore pause on macOS & pause indicator in the window's title bar (#3140)
    - Restore sane `max N%` cycles behaviour where 100% means 100% (#3141)
    - Skip compiler if error instead of aborting in compile_commits.sh (#3130)
    - Skip hidden dot files when wildcard pattern is first (#2492)
    - Support the right control key on MacOS. (#2314)
    - Turn down loguru verbosity when started with following arugments (#2722)
    - Update Tracy to 0.10 (#3022)
    - Update increaseticks sleep strategy (#2655)
    - Updated modem CONNECT response behavior (#3023)
    - Use C++11 `std::nearbyint()` for nearest FPU round (#2296)
    - Use dynamic SDL version checking for logging (#2689)

??? note "Full PR list of miscellaneous fixes"

    - Adapt to setup function additions (#2563)
    - Add missing mutex lock to RWQueue (#2773)
    - Always write the default config if the primary config file is missing (#3117)
    - Change drive macros to return boolean values (#3020)
    - Close file descriptor in cdrom ioctl class (#2685)
    - Copy only the available command line chars (#2542)
    - Do not assert if mapperfile parameter is empty (#2995)
    - Don't emulate CDROM lag for stationary calls (#2624)
    - Don't sign extend 16-bit immediates to 32-bit in ppc64le dynrec, fixes #2846 (#2850)
    - Fix `pause_when_inactive` mouse behavior for macOS and Linux (#2262)
    - Fix completion index assertion error (#2531)
    - Fix flipped ANSI colour intensity flag bug and use canonical CGA colour tag names (#2979)
    - Fix incorrect version reporting in Virtualbox LOG_WARNING. (#3002)
    - Fix macOS debugger crash (#2495)
    - Fix mistake in a comment (#2299)
    - Fix mouse pointer for MS Word 5.5, based on DOSBox-X implementation (#2504)
    - Fix no function names in Loguru stack traces on Linux (#2682)
    - Fix null pointer de-reference in dyncache on Windows (#2863)
    - Fix ppc64le backend and 64K page size support (#2828)
    - Gracefully quit stdin loops on program termination (#2392)
    - Handle exiting when `pause_when_inactive = true` (#3079)
    - Make conf path handling more robust (#2241)
    - Prevent duplicate SDL Window creation when using OpenGL (#2822)
    - Replace invalid vector.end dereference with raw pointer access (#2471)
    - Set the icon on window regeneration (#3081)
    - Store envelope channel_name as std::string (#2670)
    - Track previously added userdata when deleting the SDL resize watch (#2802)
    - Use int64_t consistently for tick durations (#2596)
    - Website - dev builds query improvement (#3168)
    - Zero initalize memory allocation in GrowWriteMask in dyn_cache (#2986)

??? note "Full PR list of documentation related changes"

    - Add Instructions to Build on Nix (#2326)
    - Add game mode support for macOS Sonoma or newer (#3016)
    - Add getting started guide (#2413)
    - Fix a few bad links in README. (#2320)
    - Fix or simplify some descriptions (#3062)
    - Fix the formatting of some config descriptions (#2560)
    - Harmonize some help strings (#2686)
    - Improve some config setting descriptions (#2578)
    - Let the command line `--help` text be translatable (#3052)
    - Minor configuration file cleanups (#2634)
    - Normalise config descriptions and add default values to most of them (#2221)
    - README.md typo Vorbis (#2791)
    - Remove opencaptures (#2970)
    - Rename 'cdda' to 'cdaudio' in the MIXER help examples (#2725)
    - Revise the README template & include link to the new Getting Started ‚Ä¶ (#2360)
    - Snip truism note from MIXER long help text (#3066)
    - String fixes in CONFIG command (#2723)
    - Update DOCUMENTATION.md (#2827)
    - Update docs with supported versions of Windows, macOS, and Linux (#2258) (#2276)
    - Update the Linux `man` page (#2837)
    - Various config setting description improvements (#2729)
    - [DRAFT] Our man page is currently unmaintained - do not install it (#2820)

??? note "Full PR list of project maintenance and other changes"

    - Add a script to compile all commits on the current branch (#2642)
    - Add docker image and CI job for ppc64le architecture (#2834)
    - Add note about InnoSetup (#2244)
    - Add several warnings to the GCC build (#2661)
    - Add support for FreeBSD and OpenBSD (#2338)
    - Add warning log if message is missing (#2566)
    - Add wrap for SDL2 to support static macos builds (#2239)
    - Another batch of PVS Studio fixes (#2756)
    - Another batch of PVS Studio fixes (#2776)
    - Avoid checked-STL false positives in Coverity build (#2561)
    - Bound and pin dependency versions (#2217)
    - Bundle all license texts with binary packages (#2420)
    - Check and log *nix `ioctl` return-code errors (#2721)
    - Clean up VESA_GetSVGAInformation() & get rid of warnings (#2715)
    - Cleanup a Coverity null-deference reloading the shader (#2633)
    - Cleanup a handful of PVS Studio warnings (#2627)
    - Cleanup a handful of unchecked return-code issues flagged by Coverity (#3180)
    - Cleanup a handul of new Coverity issues  (#2639)
    - Cleanup among PCI/Memory constants (#2733)
    - Cleanup in cross.cpp (#2447)
    - Cleanup new CI warnings due to host-side updates (#2836)
    - Cleanup two ASAN initialization order issues (#2330)
    - Compile debug builds with GCC and Clang library check flags (#2553)
    - Contribute an SDL audio test tool (#2317)
    - Debug/trace logging improvements (#2832)
    - Differentiate CLI arguments from markup tags with escapes (#2349)
    - Disable FluidSynth's own unit tests under MSYS2 CI (#2357)
    - Drop Ubuntu 18.04 from the CI workflows (#2292)
    - Drop Visual Studio 2019-specific accomodations in `.clang-format`  (#2489)
    - Encapsulate the Cache's write mask functions as members (#2990)
    - Fix OpenGL symbol type mismatch warning at link time (#3098)
    - Fix Visual Studio project & filter definitions for src/hardware (#2459)
    - Fix `format-commit.sh`, Stop reformatting `#include`s (#2388)
    - Fix a couple Coverity warnings involved unchecked return values (#2631)
    - Fix a couple recent Coverity warnings (#2368)
    - Fix compilation error on `misc_util.h`  (#2329)
    - Fix coverity sign extension warning (#3001)
    - Fix for spelling mistake on NixOS.txt (#2363)
    - Fix minor data read access issues flagged by TSAN (#2328)
    - Fix nullptr compiler warnings (#2709)
    - Fix several static analysis warnings (#2750)
    - Fix small typos on `build-nix.md`  (#2341)
    - Fixing missing header file for select() syscall when building on MacO‚Ä¶ (#2968)
    - Harmonize ManyMouse support message in the build system (#3050)
    - Hopefully make MSYS2 build pass (#2692)
    - Improve caching of subpackages (#2269)
    - Improve compile commits script (#2760)
    - Let MacOS homebrew overwrite conflicting junk files in CI (#2716)
    - Let Meson use a system call to detect the page size (#3174)
    - Make BatchFile Testable (#2618)
    - Make the DOS module depend on SDL2 net (#2358)
    - Make the RWQueue more usable for complex types (#2522)
    - Mark all core run functions with `noexcept` (#2251)
    - Move Inno note to own section (#2249)
    - Move `bit_view` value assignment to a general function (#2290)
    - Move dynamic FPU synchronization inside preprocessor defines (#2252)
    - Notify all when RWQueue stops (#2775)
    - PVS Studio fixes (#3088)
    - PVS Studio warning fixes (#3070)
    - Perform safe left-shift of signed values in dynrec operators (#2535)
    - Recommend the project-release tarball first (`main` website) (#2500)
    - Refactor Prop_path to use std_fs::path (#2700)
    - Refactor Property->Get_string to return a std::string (#3009)
    - Refactor WriteOut functions in program.cpp (#2309)
    - Refactor command line arguments (#2703)
    - Refactor shell_batch.cpp (#2342)
    - Refactor shell_misc.cpp (#2482)
    - Reinstate MSVC CI workflow (#2573)
    - Remove fontstash library (#3013)
    - Remove obsolete APIs from 'dos_system.h' (#2976)
    - Restore files required by the Linux Flatpak build (#2213)
    - Revert increaseticks sleep to 1ms (#2792)
    - Revert use of pinned vcpkg versions (#2222)
    - Show backtraces in debug builds using Loguru's assert (#2650)
    - Suppress ALSA API macros PVS Studio warnings (#2783)
    - Suppress excessively verbose `sprintf` warnings on macos + clang (#2307)
    - Sync GHC std::filesystem with v1.5.14 (#2613)
    - Sync Meson wraps with upstream (#2427)
    - Sync decoders with upstream versions (#2718)
    - Sync enet with upstream version 2.3.6 (#3012)
    - Sync flatpak metadata up to `0.81.0-alpha` (#2216)
    - Sync whereami with upstream (#3017)
    - Typo fixed in setup.cpp (#3063)
    - Update Coverity to version 2023.6.2 (#3175)
    - Update Linux AppData description (#2732)
    - Update Linux and macOS debug CI workflows  (#2628)
    - Update RPM spec file (#2659)
    - Update Windows SSL certificate authority in MSYS2 workflow (#2245)
    - Update packages/*.txt files to include ffmpeg and conan (#2805)
    - Use safe_strcpy and safe_strcat (#3003)
    - Use safer calls in dynrec and operators (#2350)
    - core_dyn_x86: Initialise rettype to avoid compiler warning (#2365)


## Localisation

### Support for modern and historic locales

- Add countries and historic locales from OS/2 Warp 4.52 (#3182)
- It is now possible to select between modern and historic (DOS era) locale style

### Translation updates

- Updates to Polish, Dutch, and Italian translations.
- The command-line help text is now translatable and correctly output UTF-8 text on Windows.
- The translation workflow has been simplified.
- A batch file for converting translations made on Windows to Unix carriage
  return format has been added.

### Script to convert GOG cp473 config files to UTF-8

Now it has two search methods to convert conf files, and you don't have to copy the config files to the batch program folder:


- Normal search. You give it a game directory (e.g. D:\DOS_GAMES\DOOM) and the batch will convert all files starting with "dosbox" with a ".conf" extension (but only those that are not UTF-8);

- Recursive search. It does the same thing, but in this case you can give it the root directory (e.g. D:\DOS_GAMES) and it will convert the conf files of all GOG games contained in that directory.



https://github.com/dosbox-staging/dosbox-staging/blob/main/contrib/scripts/GOGconf-cp437-to-UTF8.bat


https://github.com/dosbox-staging/dosbox-staging/blob/main/contrib/scripts/tools/readme-gog437.txt



??? note "Full PR list of localisation related changes"

    - Add batch file (Windows) to convert GOG cp437 config files to UTF-8 (#3031)
    - Add countries and historic locales from OS/2 Warp 4.52 (#3182)
    - Add legacy codepage to UTF-8 script (#3029)
    - Add more definitions to Unicode engine (#3084)
    - Add translation batch file for Windows (#2303)
    - Country codes cleanup, fix incorrect country set in some cases (#3134)
    - Country support improvements (#3164)
    - Fix UTF8 to DOS conversion by mistake applied twice in autoexec code (#2645)
    - Fix extended ASCII codes not being rendered in batch files (#3028)
    - Fix few English strings, update Polish (pl) translation (#2295)
    - Fix problem with loading Unicode data files in some situations (#2641)
    - Fix some mistakes in code page character to Unicode mappings (#2490)
    - Group together shell error strings (#2343)
    - Handle host code pages when running `dosbox.exe --help` on Windows (#3064)
    - Improve Arabic support in Unicode engine (#2458)
    - Improve Unicode character fallback rules (#2594)
    - Improve batch file to convert GOG cp437 config files to UTF-8 (#3042)
    - Make `--list-glshaders` output translatable (#3178)
    - Minor Unicode definitions improvements (#3153)
    - Minor country and help fixes (#3186)
    - Rework AUTOEXEC.BAT support, make it UTF-8 aware (#2425)
    - Simplify translation workflow (#2954)
    - Two trivial fixes (#2423)
    - Unicode (and [autoexec]) improvements (#2422)
    - Unicode engine improvements (#2548)
    - Unicode mapping for CYRILLIC LETTER I WITH GRAVE, RUBLE, BG (#2621)
    - Update Dutch (nl) translation (#2372)
    - Update Dutch (nl) translation (#2657)
    - Update Dutch (nl) translation (#2680)
    - Update Dutch (nl) translation (#2824)
    - Update Dutch (nl) translation (#2974)
    - Update Dutch (nl) translation (#3069)
    - Update Dutch (nl) translation (#3187)
    - Update Italian (it-IT) translation (improved some strings) (#2419)
    - Update Italian (it-IT) translation (#2327)
    - Update Italian (it-IT) translation (#2385)
    - Update Italian (it-it) translation (#2302)
    - Update Italian (it-it) translation (#2226)
    - Update Italian (it-it) translation (#2476)
    - Update Italian (it-it) translation (#2497)
    - Update Italian (it-it) translation (#2584)
    - Update Italian (it-it) translation (#2643)
    - Update Italian (it-it) translation (#2702)
    - Update Italian (it-it) translation (#2737)
    - Update Italian (it-it) translation (#2815)
    - Update Italian (it-it) translation (#2980)
    - Update Italian (it-it) translation (#3065)
    - Update Italian (it-it) translation (#3137)
    - Update Polish (pl) translation, fix one more English string (#2724)
    - Update Polish (pl) translation, trivial fix to one help string (#2644)
    - Update Polish (pl) translation (#2300)
    - Update Polish (pl) translation (#2337)
    - Update Polish (pl) translation (#2381)
    - Update Polish (pl) translation (#2493)
    - Update Polish (pl) translation (#2810)
    - Update Polish (pl) translation (#3033)
    - Update Polish (pl) translation (#3071)
    - Update Polish (pl) (#translation3176)




## Contributors

The following commit authors, sponsors, supporters, and backers all invested
their time or funds into the 0.81 release effort. Thank you!

Contributors are listed in alphabetic order.


### 0.81 commit authors

<div class="compact" markdown>

- classilla
- d10sfan
- dreamer
- johnnovak
- kcgen
- keenanweaver
- khalid586
- kklobe
- FeralChild64
- GranMinigun
- Grounded0
- Kappa971
- LowLevelMahn
- MaddTheSane
- MeAreJeenius
- NicknineTheEagle
- Nopey
- rderooy
- runlevel5
- shermp
- sulix
- thaewrapt
- ThomasEricB
- Torinde
- weirddan455

</div>


### 0.81 sponsors

Sponsors who donated more than **100 USD** in total to the project:

<div class="compact" markdown>

- Antti Peltola (3200 USD during the period)
- Wengier Wu (440 USD during the period)

</div>


### 0.81 backers

Backers who donated more than **5 USD per month** to the project:

<div class="compact" markdown>

- Burrito78
- Hugo Lucorcio
- Florent Wagner

</div>

Thank you for considering supporting our work through a donation on
[GitHub Sponsors](https://github.com/sponsors/dosbox-staging) or
[Open Collective](https://opencollective.com/dosbox-staging). Your
contribution helps us purchase the necessary hardware and licenses to keep our
project going.


## Thank you

We are grateful for all community contributions as well as the original DOSBox
project, upon which DOSBox Staging is based.

